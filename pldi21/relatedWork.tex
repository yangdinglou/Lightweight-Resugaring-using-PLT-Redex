%!TEX root = ./main.tex
\section{Related Work}
\label{sec6}
%Explain the work that are related to your problem, and to your three contributions.

As discussed many times before, our work is much related to the pioneering work of \emph{resugaring} in \cite{resugaring,hygienic}. The idea of "tagging" and "reverse desugaring" is a clear explanation of "resugaring", but it becomes very complex when the RHS of the desugaring rule becomes complex. Our approach does not need to reverse desugaring, and is more lightweight, powerful, and efficient.
For hygienic resugaring, compared with the approach of using DAG to solve the variable binding  problem in \cite{hygienic}, our approach of "lazy desugaring" can achieve kind of natural hygiene within our core language.



\emph{Macros as multi-stage computations} \cite{multistage} is a work related to our lazy expansion for sugars. Some other researches \cite{modularstaging} about multi-stage programming \cite{MSP} indicate that it is useful for implementing domain-specific languages. However, multi-stage programming is a metaprogramming method, which mainly works for run-time code generation and optimization. In contrast, our lazy resugaring approach treats sugars as part of a mixed language, rather than separate them by staging. Moreover, the lazy desugaring gives us a chance to derive evaluation rules of sugars, which is a new good point compared to multi-stage programming.

Our work is related to the \emph{Galois slicing for imperative functional programs} \cite{slicing}, a work for dynamic analyzing functional programs during execution. The forward component of the Galois connection maps a partial input $x$ to the greatest partial output $y$ that can be computed from $x$; the backward component of the Galois connection maps a partial output $y$ to the least partial input $x$ from which we can compute $y$.
%Our approach used a similar idea on slicing expressions and processing on subexpressions.
This can also be considered as a bidirectional transformation \cite{bx,lens07} and the round-tripping between desugaring and resugaring in the existing approach. In contrast to these works, our resugaring approach is basically unidirectional. It should be noted that Galois slicing may be useful to handle side effects in resugaring in the future (for example, slicing the part where side effects appear).


There is a long history of hygienic macro expansion\cite{hygienicmacro}, and a formal specific hygiene definition was given \cite{10.5555/1792878.1792884} by specific the binding scopes of macros. another formal definition of the hygienic macro\cite{EssenceofHygiene} is based on nominal logic\cite{10.1007/s001650200016}. Instead of using the desugaring rule or something else to achieve hygiene, we use the lazy desugaring with the small core language to avoid hygienic problem in our approach.
%
%When the tracking in their notation can be easily done for sugar whose rules can be derived automatically.

Our implementation is built upon the PLT Redex \cite{SEwPR}, a semantics engineering tool, but it is possible to implement our approach on other semantics engineering tools such as those in \cite{dynsem,Ksemantic} which aim to test or verify the semantics of languages. The methods of these researches can be easily combined with our approach to implementing more general rule derivation. \emph{Ziggurat} \cite{Ziggurat} is a semantic extension framework, also allowing defining new macros with semantics based on existing terms in a language. It is should be useful for static analysis of macros.
%Instead of semantics based on core language, the reduction rules of sugar derived by our approach is independent of core language, which may be more concise for static analysis.

